<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dust Days</title>
<style>
body {
  margin:0; background:#111; color:#eee;
  font-family:'Courier New',monospace;
  display:flex; justify-content:center; align-items:center;
  min-height:100vh;
}
#game { width:90%; max-width:800px; background:#222; padding:20px; border-radius:10px; }
h1 { text-align:center; letter-spacing:2px; margin-bottom:15px; }
#story { white-space:pre-line; margin-bottom:15px; min-height:280px; line-height:1.5; }
#odditiesInput { width:100%; padding:10px; border:none; border-radius:5px; margin-bottom:10px; }
button {
  padding:10px 20px; border:none; border-radius:5px;
  background:#555; color:#fff; cursor:pointer; margin-right:5px;
}
button:hover { background:#777; }
#feedback { color:#f66; font-weight:bold; text-align:center; margin-top:10px; }
#timer { color:#ffcc00; font-weight:bold; text-align:center; margin-bottom:10px; }
.hidden { display:none; }
</style>
</head>
<body>
<div id="game">
  <!-- ---------- START SCREEN ---------- -->
  <div id="startScreen">
    <h1>Dust Days</h1>
    <p style="text-align:center;">The day begins like any other.<br>It will not stay that way.</p>
    <div style="text-align:center;"><button id="startBtn">Start</button></div>
  </div>

  <!-- ---------- PLAY AREA ---------- -->
  <div id="playArea" class="hidden">
    <div id="timer">Time: 30s</div>
    <div id="story"></div>
    <input id="odditiesInput" placeholder="What seemed off?">
    <div style="text-align:center;">
      <button id="submitBtn">Submit</button>
      <button id="nextBtn" class="hidden">Next</button>
    </div>
    <p id="feedback"></p>
  </div>

  <!-- ---------- END SCREEN ---------- -->
  <div id="endScreen" class="hidden">
    <h2 id="endingTitle" style="text-align:center;"></h2>
    <p id="endingText" style="white-space:pre-line; text-align:center;"></p>
    <div style="text-align:center;">
      <button id="restartBtn">Restart</button>
    </div>
  </div>
</div>

<script>
// ----- SYNONYM MAP -----
const synonyms = {
  crow: ["bird","raven","blackbird"],
  lamppost: ["lamp","streetlight","light"],
  swing: ["chains","seat","playground"],
  pavement: ["road","path","sidewalk"],
  reflection: ["mirror","glass","window"],
  bag: ["bin","rubbish","plastic"],
  curtain: ["drape","window"],
  door: ["entrance","shopdoor"]
};

// ----- BASE STORY (fixed) -----
const baseStory = [
  "The kettle clicked off just as I stepped away. I looked in the cupboard. No bread. Iâ€™d have to go out.",
  "The pavement outside was cracked and dusty. The same cracks as yesterday, maybe deeper.",
  "At the junction a lamppost leaned a little, humming softly.",
  "I passed the small park. The swings were still. One chain creaked when the wind touched it.",
  "A crow watched from the fence as I crossed toward the bakery.",
  "The door to the shop resisted before opening. Warm air met me, thick with flour and something else.",
  "The shelves looked full but light somehow, as if the loaves were hollow.",
  "A coin rolled under the counter though no one had dropped it.",
  "When I left, my reflection in the bakery window seemed to move half a second late.",
  "Back on the road, a bin bag twitched once, then went still."
];

// Each paragraph has possible anomalies
const anomaliesPool = [
  ["pavement cracked"],
  ["lamppost humming"],
  ["swing chain creaked"],
  ["crow stared too long"],
  ["door resisted"],
  ["shelves hollow"],
  ["coin rolled alone"],
  ["reflection lagged"],
  ["bag twitched"]
];

let rounds=[]; let missed={}; let current=0; let baseTime=30; let timerInterval;

// ----- START GAME -----
function startGame(){
  document.getElementById("startScreen").classList.add("hidden");
  document.getElementById("endScreen").classList.add("hidden");
  document.getElementById("playArea").classList.remove("hidden");

  // choose up to 3 random anomalies for each of 5 sections
  rounds = [];
  for(let i=0;i<5;i++){
    const sectionParas = baseStory.slice(i*2, i*2+2).join("\n\n");
    const randomAnoms = shuffle([...anomaliesPool]).slice(0,Math.floor(Math.random()*3)+1);
    rounds.push({text:sectionParas, oddities:randomAnoms.map(a=>a[0])});
  }
  current=0; missed={}; baseTime=30;
  showRound();
}

function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}

// ----- DISPLAY ROUND -----
function showRound(){
  const round=rounds[current];
  let storyText=round.text;

  for(const odd in missed){
    if(missed[odd]>=2 && !storyText.includes(odd)){
      storyText += `\n\nThe ${odd} again, closer this time.`;
    }
  }

  document.getElementById("story").innerText=storyText;
  document.getElementById("odditiesInput").value="";
  document.getElementById("feedback").innerText="";
  document.getElementById("nextBtn").classList.add("hidden");
  document.getElementById("submitBtn").classList.remove("hidden");
  startTimer(baseTime);
}

// ----- TIMER -----
function startTimer(seconds){
  clearInterval(timerInterval);
  let time=seconds;
  document.getElementById("timer").innerText="Time: "+time+"s";
  timerInterval=setInterval(()=>{
    time--;
    document.getElementById("timer").innerText="Time: "+time+"s";
    if(time<=0){
      clearInterval(timerInterval);
      const round=rounds[current];
      round.oddities.forEach(o=>{
        missed[o]=(missed[o]||0)+1;
        baseTime=Math.max(10,baseTime-2);
      });
      document.getElementById("feedback").innerText="You waited too long. Everything kept moving.";
      endRound();
    }
  },1000);
}

// ----- GRADING -----
function fakeAIGrade(answers, correct){
  answers=answers.toLowerCase();
  let missedList=[];
  correct.forEach(o=>{
    const words=o.toLowerCase().split(" ");
    const extra=(synonyms[words[0]]||[]);
    const all=[...words,...extra];
    const match=all.some(word=>answers.includes(word));
    if(!match){
      missedList.push(o);
      missed[o]=(missed[o]||0)+1;
      baseTime=Math.max(10,baseTime-2);
    } else { missed[o]=0; }
  });
  if(missedList.length===0) return "You saw it all. Nothing slipped by.";
  return "You missed: "+missedList.join(", ");
}

// ----- END ROUND -----
function endRound(){
  clearInterval(timerInterval);
  document.getElementById("submitBtn").classList.add("hidden");
  document.getElementById("nextBtn").classList.remove("hidden");
}

document.getElementById("submitBtn").onclick=()=>{
  clearInterval(timerInterval);
  const answers=document.getElementById("odditiesInput").value;
  const round=rounds[current];
  const result=fakeAIGrade(answers,round.oddities);
  document.getElementById("feedback").innerText=result;
  endRound();
};

document.getElementById("nextBtn").onclick=()=>{
  current++;
  if(current>=rounds.length){ showEndScreen(); }
  else showRound();
};

// ----- END SCREEN -----
function showEndScreen(){
  clearInterval(timerInterval);
  document.getElementById("playArea").classList.add("hidden");
  document.getElementById("endScreen").classList.remove("hidden");

  const missedCount=Object.values(missed).reduce((a,b)=>a+b,0);
  let title="",text="";
  if(missedCount===0){
    title="You Passed Unseen.";
    text="The road straightens. The air is still.\nFor now, you are alone.";
  } else if(missedCount<=4){
    title="Something Watches.";
    text="You walked faster, but not fast enough.\nA few things kept pace.";
  } else {
    title="The Dust Knows You.";
    text="Every reflection turns toward you now.\nYou left the road long ago, though you keep walking.";
  }
  document.getElementById("endingTitle").innerText=title;
  document.getElementById("endingText").innerText=text;
}

// ----- RESTART -----
document.getElementById("restartBtn").onclick=()=>{
  document.getElementById("endScreen").classList.add("hidden");
  document.getElementById("startScreen").classList.remove("hidden");
};

// ----- START BUTTON -----
document.getElementById("startBtn").onclick=startGame;
</script>
</body>
  </html>
  
