<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dust Days</title>
<style>
body{margin:0;background:#111;color:#eee;font-family:'Courier New',monospace;display:flex;justify-content:center;align-items:center;min-height:100vh}
#game{width:90%;max-width:800px;background:#222;padding:20px;border-radius:10px}
h1{text-align:center;letter-spacing:2px;margin-bottom:15px}
#story{white-space:pre-line;margin-bottom:15px;min-height:300px;line-height:1.5;}
#odditiesInput{width:100%;padding:10px;border:none;border-radius:5px;margin-bottom:10px;}
button{padding:10px 20px;border:none;border-radius:5px;background:#555;color:#fff;cursor:pointer;margin-right:5px;}
button:hover{background:#777}
#feedback{color:#f66;font-weight:bold;text-align:center;margin-top:10px;}
#timer{color:#ffcc00;font-weight:bold;text-align:center;margin-bottom:10px;}
</style>
</head>
<body>
<div id="game">
<h1>Dust Days</h1>
<div id="timer">Time: 30s</div>
<div id="story"></div>
<input id="odditiesInput" placeholder="Type the oddities you noticed…">
<button id="submitBtn">Submit</button>
<button id="nextBtn" style="display:none">Next</button>
<p id="feedback"></p>
</div>

<script>
// --- Story Rounds (1 subtle oddity per paragraph) ---
const rounds=[
{ text:`I left the flat and walked down the road. The kettle in the kitchen was still warm. I noticed the pavement was cracked.

The sun hit the terraced houses. One window reflected me, slightly tilted. Birds chirped somewhere, ordinary sounds that felt off.

I reached the small park. The swing set didn’t move, but the chains clinked faintly.`,
  oddities:["pavement cracked","window tilted","swing chains clink"]
},
{ text:`The street stretched ahead. Shadows fell long, though the sun was high. A distant dog barked, echoing strangely.

I walked past a shop with half-closed shutters. The lamppost hummed faintly. I hurried on.

The alley seemed narrower than usual. Walls were clean but shapes shifted under paint.`,
  oddities:["shadows echo","lamppost hummed","shapes under paint"]
}
];

let current=0;
let missed={};
let baseTime=60; // seconds
let timerInterval;

// --- Show Round ---
function showRound(){
  const round=rounds[current];
  let storyText=round.text;
  // Amplify missed oddities
  for(const odd in missed){
    if(missed[odd]>=2 && !storyText.includes(odd)){
      storyText+="\n\nThe "+odd+" returns, more insistent this time.";
    }
  }
  document.getElementById("story").innerText=storyText;
  document.getElementById("odditiesInput").value="";
  document.getElementById("feedback").innerText="";
  document.getElementById("nextBtn").style.display="none";
  document.getElementById("submitBtn").style.display="inline-block";
  startTimer(baseTime);
}

// --- Timer ---
function startTimer(seconds){
  clearInterval(timerInterval);
  let time=seconds;
  document.getElementById("timer").innerText="Time: "+time+"s";
  timerInterval=setInterval(()=>{
    time--;
    document.getElementById("timer").innerText="Time: "+time+"s";
    if(time<=0){
      clearInterval(timerInterval);
      endRound(true); // timed out
    }
  },1000);
}

// --- Fake AI grading ---
function fakeAIGrade(answers, correct){
  answers=answers.toLowerCase();
  let missedList=[];
  correct.forEach(o=>{
    if(!answers.includes(o.split(" ")[0])){
      missedList.push(o);
      missed[o]=(missed[o]||0)+1;
      baseTime=Math.max(10, baseTime-2); // reduce time for next round
    } else { missed[o]=0; }
  });
  if(missedList.length===0) return "Perfect — you spotted everything.";
  return "You missed: "+missedList.join(", ");
}

// --- End Round ---
function endRound(timedOut=false){
  clearInterval(timerInterval);
  const round=rounds[current];
  const answers=document.getElementById("odditiesInput").value;
  const result=timedOut ? "Time ran out!" : fakeAIGrade(answers,round.oddities);
  document.getElementById("feedback").innerText=result;
  document.getElementById("submitBtn").style.display="none";
  document.getElementById("nextBtn").style.display="inline-block";
}

// --- Event Listeners ---
document.getElementById("submitBtn").onclick=()=>{ endRound(false); };

document.getElementById("nextBtn").onclick=()=>{
  current++;
  if(current>=rounds.length){
    showEndScreen();
  } else showRound();
};

// --- Custom End Screen ---
function showEndScreen(){
  document.getElementById("story").innerText="";
  document.getElementById("odditiesInput").style.display="none";
  document.getElementById("submitBtn").style.display="none";
  document.getElementById("nextBtn").style.display="none";
  clearInterval(timerInterval);

  let missedCount=Object.values(missed).reduce((a,b)=>a+b,0);
  let msg="";
  if(missedCount===0){
    msg="You walked the streets carefully. Nothing could surprise you. You survived.";
  } else if(missedCount<=3){
    msg="Some things slipped by unnoticed. They linger in the corners, watching.";
  } else{
    msg="The missed oddities have consumed your world. Shadows move where they shouldn’t. You are part of the streets now.";
  }
  document.getElementById("story").innerText=msg;
  document.getElementById("timer").innerText="";
  document.getElementById("feedback").innerText="";
}

// --- Start ---
showRound();
</script>
</body>
</html>

